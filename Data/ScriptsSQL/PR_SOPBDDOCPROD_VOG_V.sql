/*
SP : Para Validar antes de procesar los documentos a procesar
EXEC PR_SOPBDDOCPROD_VOG_V 
 @SOPNUMBE		='A-FAC-00001038'
,@DOCID		='A-FACTURA'
,@IDDOC   	='A-FAC'

*/  
IF exists (select * from dbo.sysobjects where id = object_id(N'dbo.PR_SOPBDDOCPROD_VOG_V') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure dbo.PR_SOPBDDOCPROD_VOG_V
GO

CREATE  PROCEDURE PR_SOPBDDOCPROD_VOG_V
(@SOPNUMBE char(21)  
,@DOCID char(15)
,@IDDOC char(15)=''
,@CUSTNMBR CHAR(15)
,@DOCDATE DATE
,@NROCONTROL NVARCHAR(81)=''
)				  
AS
BEGIN
	DECLARE @RESPUESTA   VARCHAR(50)='Registro Validado',@ERROR INT=0
	DECLARE @DATE_INSERT DATETIME =GETDATE()
	
	IF NOT EXISTS(SELECT 1 FROM RM00101 with (NOLOCK) WHERE CUSTNMBR=@CUSTNMBR)
	BEGIN
		SET @RESPUESTA='Cliente no Existe'
		SET @ERROR=1
	END

	IF @ERROR=0
	IF NOT EXISTS(SELECT 1 FROM SOP40200 with (NOLOCK) WHERE rtrim(DOCID)=@DOCID)
	BEGIN
		SET @RESPUESTA='No existe el ID de Documento'
		SET @ERROR=1
	END

	IF @ERROR=0
	IF EXISTS(SELECT 1 FROM SOP10100 with (NOLOCK) WHERE SOPNUMBE=@SOPNUMBE)
	BEGIN
		SET @RESPUESTA='Documento ya se encuentra en Trabajo'
		SET @ERROR=1
	END

	IF @ERROR=0
	IF EXISTS(SELECT 1 FROM SOP30200 with (NOLOCK) WHERE SOPNUMBE=@SOPNUMBE)
	BEGIN
		SET @RESPUESTA='Documento ya se encuentra en Contabilizado'
		SET @ERROR=1
	END

	SELECT  @ERROR ERROR,@RESPUESTA RESPUESTA
END